{% extends "base.html" %}

{% block title %}Impostazioni - Contaspiccioli{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div>
        <h1 class="text-3xl font-bold">Impostazioni</h1>
        <p class="text-muted-foreground">Gestione categorie e parametri</p>
    </div>

    <!-- Budget Parameters -->
    <div class="card p-6">
        <h2 class="text-xl font-semibold mb-4">Parametri Budget</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <div class="p-4 bg-muted rounded-lg text-center">
                <p class="text-2xl font-bold text-accent">{{ config.default_income|currency }}</p>
                <p class="text-sm text-muted-foreground">Entrata mensile</p>
            </div>
            <div class="p-4 bg-muted rounded-lg text-center">
                <p class="text-2xl font-bold">{{ (config.fixed_percentage * 100)|round(1) }}%</p>
                <p class="text-sm text-muted-foreground">Spese fisse</p>
            </div>
            <div class="p-4 bg-muted rounded-lg text-center">
                <p class="text-2xl font-bold">{{ (config.variable_percentage * 100)|round(1) }}%</p>
                <p class="text-sm text-muted-foreground">Spese variabili</p>
            </div>
            <div class="p-4 bg-muted rounded-lg text-center">
                <p class="text-2xl font-bold">{{ (config.tax_percentage * 100)|round(1) }}%</p>
                <p class="text-sm text-muted-foreground">Accantonamento tasse</p>
            </div>
            <div class="p-4 bg-muted rounded-lg text-center">
                <p class="text-2xl font-bold">{{ (config.investment_percentage * 100)|round(1) }}%</p>
                <p class="text-sm text-muted-foreground">Investimenti</p>
            </div>
        </div>
        <p class="text-sm text-muted-foreground mt-4">
            Per modificare questi parametri, aggiorna il file .env o config.yaml
        </p>
    </div>

    <!-- Fixed Categories -->
    <div class="card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Spese Fisse</h2>
            <span class="text-muted-foreground">
                Budget: {{ fixed_categories|sum(attribute='monthly_budget')|currency }}
            </span>
        </div>
        <div class="space-y-2">
            {% for cat in fixed_categories %}
            <div class="flex items-center justify-between p-3 bg-muted rounded-lg">
                <div class="flex items-center gap-3">
                    <span class="text-xl">{{ cat.icon }}</span>
                    <span>{{ cat.name }}</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="font-mono">{{ cat.monthly_budget|currency }}</span>
                    <button hx-delete="/api/categories/{{ cat.id }}"
                            hx-confirm="Eliminare questa categoria?"
                            hx-swap="none"
                            hx-on::after-request="location.reload()"
                            class="text-muted-foreground hover:text-accent-red">

                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Variable Categories -->
    <div class="card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Spese Variabili</h2>
            <span class="text-muted-foreground">
                Budget: {{ variable_categories|sum(attribute='monthly_budget')|currency }}
            </span>
        </div>
        <div class="space-y-2">
            {% for cat in variable_categories %}
            <div class="flex items-center justify-between p-3 bg-muted rounded-lg">
                <div class="flex items-center gap-3">
                    <span class="text-xl">{{ cat.icon }}</span>
                    <span>{{ cat.name }}</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="font-mono">{{ cat.monthly_budget|currency }}</span>
                    <button hx-delete="/api/categories/{{ cat.id }}"
                            hx-confirm="Eliminare questa categoria?"
                            hx-swap="none"
                            hx-on::after-request="location.reload()"
                            class="text-muted-foreground hover:text-accent-red">

                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Add Category Form -->
    <div class="card p-6">
        <h2 class="text-xl font-semibold mb-4">Aggiungi Categoria</h2>
        <form hx-post="/api/categories"
              hx-swap="none"
              hx-on::after-request="location.reload()"
              class="grid grid-cols-1 md:grid-cols-5 gap-4">
            <input type="text" name="name" placeholder="Nome categoria" required
                   class="bg-muted border border-border rounded px-3 py-2">
            <select name="type" required
                    class="bg-muted border border-border rounded px-3 py-2">
                <option value="fissa">Spesa fissa</option>
                <option value="variabile">Spesa variabile</option>
            </select>
            <input type="number" name="monthly_budget" step="0.01" placeholder="Budget mensile"
                   class="bg-muted border border-border rounded px-3 py-2">
            <input type="text" name="icon" placeholder="Emoji" maxlength="4"
                   class="bg-muted border border-border rounded px-3 py-2">
            <button type="submit"
                    class="bg-accent text-white rounded px-4 py-2 hover:bg-accent/90 transition">
                Aggiungi
            </button>
        </form>
    </div>
</div>
{% endblock %}
